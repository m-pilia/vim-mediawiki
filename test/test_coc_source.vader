Before:
  let b:script = 'autoload/coc/source/mediawiki.vim'
  source test/utils.vim


After:
  unlet! b:script

  unlet! Function
  unlet! mock
  unlet! options

  unlet! g:vim_mediawiki_completion_namespaces
  unlet! b:vim_mediawiki_completion_namespaces
  unlet! g:vim_mediawiki_site
  unlet! b:vim_mediawiki_site


Execute(Test s:get_namespaces()):
  let Function = GetFunction(b:script, 'get_namespaces')

  let g:vim_mediawiki_completion_namespaces = {
  \ 'default': 'default_namespaces',
  \ 'some_site': 'some_site_namespaces',
  \ }

  " Test global retrieval
  let g:vim_mediawiki_site = 'some_site'

  AssertEqual
  \ g:vim_mediawiki_completion_namespaces['some_site'],
  \ Function(bufnr(''))

  " Test buffer-local retrieval
  let b:vim_mediawiki_completion_namespaces = {
  \ 'some_site': 'some_site_namespaces_ovewritten',
  \ }

  AssertEqual
  \ b:vim_mediawiki_completion_namespaces['some_site'],
  \ Function(bufnr(''))

  " Test default fallback
  let g:vim_mediawiki_site = 'some_unknown_site'

  AssertEqual
  \ g:vim_mediawiki_completion_namespaces['default'],
  \ Function(bufnr(''))


Execute(Test coc#source#mediawiki#init()):
  AssertEqual
  \ {
  \   'priority': 90,
  \   'shortcut': 'MW',
  \   'filetypes': ['mediawiki'],
  \ },
  \ coc#source#mediawiki#init()
