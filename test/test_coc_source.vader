Before:
  let b:script = 'autoload/coc/source/mediawiki.vim'
  source test/utils.vim


After:
  unlet! b:script

  unlet! Function
  unlet! mock
  unlet! options
  unlet! b:vim_mediawiki_some_variable
  unlet! g:vim_mediawiki_some_variable

  unlet! g:vim_mediawiki_completion_namespaces
  unlet! b:vim_mediawiki_completion_namespaces
  unlet! g:vim_mediawiki_site
  unlet! b:vim_mediawiki_site


Execute(Test s:get_var):
  let Function = GetFunction(b:script, 'get_var')

  let g:vim_mediawiki_some_variable = 'some_global_value'

  AssertEqual
  \ g:vim_mediawiki_some_variable,
  \ Function(bufnr(''), 'some_variable')

  let b:vim_mediawiki_some_variable = 'some_local_value'

  AssertEqual
  \ b:vim_mediawiki_some_variable,
  \ Function(bufnr(''), 'some_variable')


Execute(Test s:get_namespaces):
  let Function = GetFunction(b:script, 'get_namespaces')

  let g:vim_mediawiki_completion_namespaces = {
  \ 'default': 'default_namespaces',
  \ 'some_site': 'some_site_namespaces',
  \ }

  let g:vim_mediawiki_site = 'some_site'

  AssertEqual
  \ g:vim_mediawiki_completion_namespaces['some_site'],
  \ Function(bufnr(''))

  let g:vim_mediawiki_site = 'some_unknown_site'

  AssertEqual
  \ g:vim_mediawiki_completion_namespaces['default'],
  \ Function(bufnr(''))


Execute(Test coc#source#mediawiki#init()):
  AssertEqual
  \ {
  \   'priority': 90,
  \   'shortcut': 'MediaWiki',
  \   'filetypes': ['mediawiki'],
  \ },
  \ coc#source#mediawiki#init()
